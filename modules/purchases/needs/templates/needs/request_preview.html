{% extends 'base.html' %}
{% block title %}–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥ –∑–∞—è–≤–∫–∏{% endblock %}
{% block header %}üîç –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥ –∑–∞—è–≤–∫–∏{% endblock %}

{% block content %}
<div class="d-flex justify-content-between mb-3">
  <a href="{{ url_for('needs.request_form') }}" class="btn btn-outline-secondary">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</a>
  <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
</div>

<div class="alert alert-info">
  <div><strong>–ü—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–æ (—Å–ø–æ–∂–∏–≤–∞—á):</strong> {{ company.name if company else '‚Äî' }}</div>
  <div class="small text-muted">–ü–ª–∞—Ç–Ω–∏–∫ –≤–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞ ¬´–†–æ–∑–ø–æ–¥—ñ–ª–æ–º –º—ñ–∂ –ü–ª–∞—Ç–Ω–∏–∫–∞–º–∏¬ª.</div>
</div>

<form method="POST" action="{{ url_for('needs.request_submit') }}">
  <input type="hidden" name="company_id" value="{{ company.id if company else '' }}">

  <table class="table table-striped table-hover table-bordered align-middle text-center">
    <thead class="table-success">
      <tr>
        <th style="width:56px;">#</th>
        <th class="text-start">–ü—Ä–æ–¥—É–∫—Ç</th>
        <th class="text-start">–¢–∞—Ä–∞</th>
        <th class="text-start">–ü–ª–∞—Ç–Ω–∏–∫ (–∞–≤—Ç–æ)</th>
        <th class="text-end" style="width:140px;">–ö—ñ–ª—å–∫—ñ—Å—Ç—å</th>
        <th class="text-start" style="width:220px;">–í–∏—Ä–æ–±–Ω–∏–∫</th>
      </tr>
    </thead>
    <tbody>
      {% for it in items %}
        <tr>
          <td>{{ loop.index }}</td>
          <td class="text-start">{{ it.product_name }}</td>
          <td class="text-start">{{ it.package or '‚Äî' }}</td>
          <td class="text-start">{{ it.payer_name or '‚Äî' }}</td>
          <td class="text-end">{{ '%.3f'|format(it.requested_qty) }}</td>
          <td class="text-start">
            {{ it.manufacturer_name or '‚Äî' }}
            {# –Ø–∫—â–æ —Ö–æ—á–µ—à –≤—Å–µ –∂ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ ID ‚Äî –º–æ–∂–Ω–∞ –ø—Ä–∏—Ö–æ–≤–∞–Ω–æ, –∞–ª–µ –±–µ–∫–µ–Ω–¥ –π–æ–≥–æ —ñ–≥–Ω–æ—Ä—É—î #}
            {# <input type="hidden" name="item_manufacturer_id[]" value="{{ it.manufacturer_id or '' }}"> #}
          </td>

          <!-- –ø—Ä–∏—Ö–æ–≤–∞–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è –±–µ–∫–µ–Ω–¥—É -->
          <input type="hidden" name="item_product_id[]" value="{{ it.product_id }}">
          <input type="hidden" name="item_payer_id[]" value="{{ it.payer_id or '' }}">
          <input type="hidden" name="item_qty[]" value="{{ '%.3f'|format(it.requested_qty) }}">
        </tr>
      {% else %}
        <tr><td colspan="6" class="text-muted">–í–∏ –Ω–µ –≤–∏–±—Ä–∞–ª–∏ –∂–æ–¥–Ω–æ—ó –ø–æ–∑–∏—Ü—ñ—ó</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="d-flex gap-2">
    <a href="{{ url_for('needs.request_form') }}" class="btn btn-outline-secondary">–ó–º—ñ–Ω–∏—Ç–∏</a>
    <button type="submit" class="btn btn-success" {% if not items %}disabled{% endif %}>–°—Ñ–æ—Ä–º—É–≤–∞—Ç–∏</button>
  </div>
</form>
{% endblock %}

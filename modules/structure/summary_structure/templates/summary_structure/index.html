{# modules/structure/summary_structure/templates/summary_structure/index.html #}

{% extends "base.html" %}

{% block title %}–ü—ñ–¥—Å—É–º–∫–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Å—ñ–≤–Ω–∏—Ö –ø–ª–æ—â{% endblock %}

{% block content %}
<div class="d-flex justify-content-between mb-3">
  <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
</div>

<h2 class="mb-4">üìä –ü—ñ–¥—Å—É–º–∫–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Å—ñ–≤–Ω–∏—Ö –ø–ª–æ—â</h2>

<form method="post" class="mb-4">
  {{ form.hidden_tag() }}
  <div class="row g-3">
    <div class="col-md-3">
      {{ form.season_year.label(class="form-label") }}
      {{ form.season_year(class="form-control") }}
    </div>
    <div class="col-md-3">
      {{ form.cluster.label(class="form-label") }}
      {{ form.cluster(class="form-select") }}
    </div>
    <div class="col-md-2 d-flex align-items-end">
      {{ form.submit(class="btn btn-success") }}
    </div>
  </div>
</form>

{% if clusters %}
  {% for cluster in clusters %}
    <h4 class="mt-4 text-success">–ö–ª–∞—Å—Ç–µ—Ä: {{ cluster }}</h4>
    <table class="table table-bordered table-striped table-hover align-middle">
      <thead class="table-success text-center">
        <tr>
          <th>–ü—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–æ</th>
          {% for culture in cultures %}
            <th>{{ culture }}</th>
          {% endfor %}
          <th>–†–∞–∑–æ–º</th>
        </tr>
      </thead>
      <tbody class="text-center">
        {% for company, cultures_data in result[cluster].items() %}
          <tr>
            <td class="text-start">{{ company }}</td>
            {% for culture in cultures %}
              <td>{{ "%.2f"|format(cultures_data.get(culture, 0)) }}</td>
            {% endfor %}
            <td class="fw-bold">{{ "%.2f"|format(company_totals[cluster][company]) }}</td>
          </tr>
        {% endfor %}
        <tr class="table-secondary fw-bold">
          <td>–†–∞–∑–æ–º –ø–æ –∫–ª–∞—Å—Ç–µ—Ä—É</td>
          {% for culture in cultures %}
            <td>{{ "%.2f"|format(cluster_totals[cluster][culture]) }}</td>
          {% endfor %}
          <td>{{ "%.2f"|format(cluster_totals[cluster]['–†–∞–∑–æ–º']) }}</td>
        </tr>
      </tbody>
    </table>
  {% endfor %}

  <h4 class="mt-4 text-primary">–ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞</h4>
  <table class="table table-bordered table-striped table-hover align-middle">
    <thead class="table-primary text-center">
      <tr>
        <th> </th>
        {% for culture in cultures %}
          <th>{{ culture }}</th>
        {% endfor %}
        <th>–†–∞–∑–æ–º</th>
      </tr>
    </thead>
    <tbody class="text-center">
      <tr class="fw-bold">
        <td>–†–∞–∑–æ–º</td>
        {% for culture in cultures %}
          <td>{{ "%.2f"|format(total_row[culture]) }}</td>
        {% endfor %}
        <td>{{ "%.2f"|format(total_row['–†–∞–∑–æ–º']) }}</td>
      </tr>
    </tbody>
  </table>
{% else %}
  <p class="text-muted">–î–∞–Ω—ñ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –¥–ª—è –≤–∏–±—Ä–∞–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤.</p>
{% endif %}
{% endblock %}

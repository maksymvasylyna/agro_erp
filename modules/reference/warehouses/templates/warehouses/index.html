{% extends "base.html" %}
{% block title %}{{ title or "–î–æ–≤—ñ–¥–Ω–∏–∫ —Å–∫–ª–∞–¥—ñ–≤" }}{% endblock %}

{% block content %}
<h2 class="mb-3">{{ header or "üè∑Ô∏è –î–æ–≤—ñ–¥–Ω–∏–∫ —Å–∫–ª–∞–¥—ñ–≤ –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤" }}</h2>

<div class="d-flex gap-2 mb-3">
  <button type="button" class="btn btn-outline-secondary" onclick="history.back()">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
  <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
</div>

<form class="row g-2 align-items-end mb-3" method="get" action="{{ url_for('warehouses.index') }}">
  <div class="col-md-3">
    <label class="form-label">–ü—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–æ</label>
    <select class="form-select" name="company_id" onchange="this.form.submit()">
      <option value="">‚Äî –£—Å—ñ ‚Äî</option>
      {% for c in companies %}
        <option value="{{ c.id }}" {{ 'selected' if company_id==c.id else '' }}>{{ c.name }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="col-md-2">
    <label class="form-label">–ê–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å</label>
    <select class="form-select" name="active" onchange="this.form.submit()">
      <option value="">‚Äî –£—Å—ñ ‚Äî</option>
      <option value="1" {{ 'selected' if active=='1' else '' }}>–ê–∫—Ç–∏–≤–Ω—ñ</option>
      <option value="0" {{ 'selected' if active=='0' else '' }}>–ù–µ–∞–∫—Ç–∏–≤–Ω—ñ</option>
    </select>
  </div>

  <div class="col-md-3">
    <label class="form-label">–ü–æ—à—É–∫ –∑–∞ –Ω–∞–∑–≤–æ—é</label>
    <input class="form-control" type="text" name="q" value="{{ q or '' }}" placeholder="–ù–∞–ø—Ä. –°–∫–ª–∞–¥ ‚Ññ1">
  </div>

  <div class="col-md-4 d-flex gap-2">
    <button class="btn btn-outline-primary ms-auto" type="submit">–§—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏</button>
    <a class="btn btn-primary" href="{{ url_for('warehouses.new', company_id=company_id) }}">‚ûï –ù–æ–≤–∏–π —Å–∫–ª–∞–¥</a>
  </div>
</form>

<table class="table table-striped table-bordered align-middle">
  <thead class="table-light">
    <tr>
      <th style="width:40%">–ù–∞–∑–≤–∞</th>
      <th style="width:30%">–ü—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–æ</th>
      <th style="width:10%">–°—Ç–∞—Ç—É—Å</th>
      <th style="width:20%">–î—ñ—ó</th>
    </tr>
  </thead>
  <tbody>
    {% if rows and rows|length %}
      {% for r in rows %}
        <tr>
          <td><b>{{ r.name }}</b></td>
          <td>{{ (r.company.name if r.company else ('#'+r.company_id|string)) }}</td>
          <td>
            {% if r.is_active %}
              <span class="badge bg-success">–∞–∫—Ç–∏–≤–Ω–∏–π</span>
            {% else %}
              <span class="badge bg-secondary">–Ω–µ–∞–∫—Ç–∏–≤–Ω–∏–π</span>
            {% endif %}
          </td>
          <td>
            <div class="d-flex flex-wrap gap-2">
              <a class="btn btn-sm btn-outline-primary" href="{{ url_for('warehouses.edit', wid=r.id) }}">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a>

              <form method="post" action="{{ url_for('warehouses.toggle', wid=r.id) }}" onsubmit="return confirm('–ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —Å–∫–ª–∞–¥—É ¬´{{ r.name }}¬ª?');">
                <button class="btn btn-sm btn-outline-warning" type="submit">
                  {% if r.is_active %}–î–µ–∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏{% else %}–ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏{% endif %}
                </button>
              </form>

              <form method="post" action="{{ url_for('warehouses.delete', wid=r.id) }}" onsubmit="return confirm('–î–µ–∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ —Å–∫–ª–∞–¥ ¬´{{ r.name }}¬ª?');">
                <button class="btn btn-sm btn-outline-danger" type="submit">üóëÔ∏è –î–µ–∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏</button>
              </form>
            </div>
          </td>
        </tr>
      {% endfor %}
    {% else %}
      <tr><td colspan="4" class="text-center text-muted">–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.</td></tr>
    {% endif %}
  </tbody>
</table>
{% endblock %}

{% extends 'base.html' %}
{% block title %}–ó–∞–ª–∏—à–∫–∏ —Å–∫–ª–∞–¥—É{% endblock %}

{% block content %}
<div class="d-flex justify-content-between mb-3">
  <div>
    <a href="{{ url_for('warehouse.index') }}" class="btn btn-outline-secondary">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</a>
    <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
  </div>
  <form method="post" action="{{ url_for('warehouse.stock_clear') }}" onsubmit="return confirm('–¢–æ—á–Ω–æ –æ—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –∑–∞–ª–∏—à–∫–∏ (—É—Å—ñ —Ä—É—Ö–∏)?');">
    <input type="hidden" name="warehouse_id" value="{{ warehouse_id }}">
    <button type="submit" class="btn btn-outline-danger">üßπ –û—á–∏—Å—Ç–∏—Ç–∏ –∑–∞–ª–∏—à–∫–∏</button>
  </form>
</div>

<div class="container mt-4">
  <h2 class="text-success mb-4">üè¨ –ó–∞–ª–∏—à–∫–∏ —Å–∫–ª–∞–¥—É</h2>

  <!-- –§—ñ–ª—å—Ç—Ä–∏ -->
  <form method="get" class="card shadow-sm rounded-2 border-success mb-4">
    <div class="card-body">
      <div class="row g-3">
        <input type="hidden" name="warehouse_id" value="{{ warehouse_id }}">
        <div class="col-md-6">
          <label class="form-label">–ü—Ä–æ–¥—É–∫—Ç</label>
          <select name="product_id" class="form-select">
            <option value="">–£—Å—ñ</option>
            {% for pid, pname in product_opts %}
              <option value="{{ pid }}" {% if product_id == pid %}selected{% endif %}>{{ pname }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-6">
          <label class="form-label">–°–ø–æ–∂–∏–≤–∞—á (–ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–æ)</label>
          <select name="consumer" class="form-select">
            <option value="">–£—Å—ñ</option>
            {% for cname in consumer_opts %}
              <option value="{{ cname }}" {% if consumer == cname %}selected{% endif %}>{{ cname }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-12 d-flex justify-content-end gap-2">
          <a href="{{ url_for('warehouse.stock_index', warehouse_id=warehouse_id) }}" class="btn btn-outline-secondary">‚ôªÔ∏è –°–∫–∏–Ω—É—Ç–∏</a>
          <button type="submit" class="btn btn-outline-primary">üîç –§—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏</button>
        </div>
      </div>
    </div>
  </form>

  <!-- –¢–∞–±–ª–∏—Ü—è –∑–∞–ª–∏—à–∫—ñ–≤ -->
  <table class="table table-hover table-striped table-bordered text-center align-middle">
    <thead class="table-success">
      <tr>
        <th class="text-start">–ü—Ä–æ–¥—É–∫—Ç</th>
        <th>–í–∏—Ä–æ–±–Ω–∏–∫</th>
        <th>–ü–∞–∫—É–≤–∞–Ω–Ω—è</th>
        <th>–û–¥.</th>
        <th class="text-start">–°–ø–æ–∂–∏–≤–∞—á</th>
        <th class="text-start">–ü–ª–∞—Ç–Ω–∏–∫</th>
        <th>–ë–∞–ª–∞–Ω—Å</th>
      </tr>
    </thead>
    <tbody>
      {% for r in rows %}
      <tr>
        <td class="text-start">{{ r.last_product_name or r.product.name }}</td>
        <td>{{ r.last_manufacturer or '‚Äî' }}</td>
        <td>{{ r.last_package or '‚Äî' }}</td>
        <td>{{ r.last_unit_text or r.unit_text or '‚Äî' }}</td>
        <td class="text-start">{{ r.last_consumer or '‚Äî' }}</td>
        <td class="text-start">{{ r.last_payer or '‚Äî' }}</td>
        <td><strong>{{ '%.2f' | format(r.balance or 0) }}</strong></td>
      </tr>
      {% else %}
      <tr>
        <td colspan="7" class="text-muted">–î–∞–Ω–∏—Ö –Ω–µ–º–∞—î</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
